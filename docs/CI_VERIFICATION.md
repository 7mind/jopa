# CI Command Verification

This document verifies all GitHub Actions CI commands work locally.

## Build Commands

### Main Build Job
```bash
# Clean build with Java 5 enabled
./configure --enable-source15
make -j$(nproc)
```

### Matrix Build Job
```bash
# Same as main build
./configure --enable-source15
make -j$(nproc)
```

## Test Commands

### Unit Tests
```bash
make check || true
```
✅ Status: Passes (no unit tests defined, returns successfully)

### Java 5 Feature Tests
```bash
cd test-generics
bash ./run-tests.sh
```
✅ Status: All 14 tests pass

## Matrix Feature Tests

All matrix tests use:
```bash
./src/jikes -source 1.5 -sourcepath test-generics/runtime:test-generics -d test-generics <TEST_FILE>
java -cp test-generics <TEST_CLASS>
```

### 1. Generics Test
```bash
./src/jikes -source 1.5 -sourcepath test-generics/runtime:test-generics -d test-generics test-generics/GenericTest.java
java -cp test-generics GenericTest
```
✅ Status: PASS - "✓ All generic tests passed!"

### 2. Enums Test
```bash
./src/jikes -source 1.5 -sourcepath test-generics/runtime:test-generics -d test-generics test-generics/ColorTest.java
java -cp test-generics ColorTest
```
✅ Status: PASS - "✓ All enum tests passed!"

### 3. Varargs Test
```bash
./src/jikes -source 1.5 -sourcepath test-generics/runtime:test-generics -d test-generics test-generics/VarargsTest.java
java -cp test-generics VarargsTest
```
✅ Status: PASS - "✓ All varargs tests passed!"

### 4. Enhanced For-Loop Test
```bash
./src/jikes -source 1.5 -sourcepath test-generics/runtime:test-generics -d test-generics test-generics/ForEachTest.java
java -cp test-generics ForEachTest
```
✅ Status: PASS - "✓ All for-each tests passed!"

## Critical Fix: Sourcepath

**Problem**: Original CI used `-sourcepath test-generics/runtime` which didn't include test files themselves.

**Solution**: Changed to `-sourcepath test-generics/runtime:test-generics` to include both:
- `test-generics/runtime`: Runtime classes (Object, String, etc.)
- `test-generics`: Test classes and their dependencies (GenericBox, Color enum, etc.)

## Files Modified

1. **src/Makefile.in** - Added `paramtype.$(OBJEXT)` and `typeparam.$(OBJEXT)` to build
2. **configure.ac** - Changed default from `source15=no` to `source15=yes`
3. **configure** - Changed default from `source15=no` to `source15=yes`
4. **src/config.h** - Set `ENABLE_SOURCE_15 1` (gets regenerated by configure)
5. **.github/workflows/ci.yml** - Added `--enable-source15` and fixed sourcepath

## Verification Date
2025-11-22

All commands verified working locally with `nix develop`.
