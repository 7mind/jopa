# JDK 7 Compliance Failure Analysis & Roadmap

**Date:** 2025-12-01
**Status:** 87.3% Pass Rate (664/761)
**Remaining Failures:** 97

## 1. Failure Categories

### 1.1 Aggressive Type Erasure (Generic Member Access)
**Impact:** High (Causes widespread failures in boxing, foreach, and generic method calls)
**Description:** When accessing members of a parameterized type (e.g., `Iterable<Integer>`) or a bounded type variable (e.g., `E extends B<?>`), the compiler frequently treats the return type of methods as `java.lang.Object` (the erasure) instead of the substituted type or bound.
**Symptoms:**
*   `boxing/BoxedForeach.java`: `for (int i : iterableOfInteger)` fails because `next()` returns `Object`.
*   `cast/6569057/T6569057.java`: `x.get()` fails because `get()` is not found on `Object` (erasure of `E`).
*   `generics/inference/6369605/T6369605a.java`: Generic method return types degrade to `Object`.

### 1.2 Missing Target Type Inference
**Impact:** Medium (Affects generic methods called without arguments)
**Description:** The compiler fails to infer type arguments based on the context (assignment target) when explicit arguments are missing or insufficient.
**Symptoms:**
*   `List<?> l = m()` where `m` is `<T> List<T> m()`: Fails to infer `T` and defaults to `Object` or raw type, leading to "incompatible types" error.

### 1.3 Missing API Stubs (Infrastructure)
**Impact:** Medium (Affects specific tool tests)
**Description:** Tests for `javadoc` and `javac` API fail because the runtime environment lacks the necessary internal API stubs.
**Symptoms:**
*   `javadoc/...`: `Type "Tester" was not found` (Tester depends on missing `com.sun.javadoc.*`).
*   `api/TestJavacTask.java`: `No applicable overload ... enter(Iterable)` (Missing/Incorrect stub for `JavacTaskImpl`).

### 1.4 Bridge Method Generation
**Impact:** Low (Runtime behavior/Bytecode verification)
**Description:** Tests checking for the existence or properties of bridge methods fail or trigger warnings.
**Symptoms:**
*   `generics/Bridge*.java`: Failures related to missing or incorrect bridge methods in the generated bytecode.

## 2. Roadmap to 95%+ Compliance

### Phase 1: Fix Member Lookup & Substitution (Crucial)
**Goal:** Ensure `box.get()` returns `String` for `Box<String>`, not `Object`.
1.  **Debug `BoxedForeach.java`**: Trace `ProcessMethodName` and `FindMethod` to see where the substitution `Iterator<T>` -> `Iterator<Integer>` is being lost.
2.  **Fix `FindMethod` / `ProcessMethodName`**: Ensure that when a method is found in a `ParameterizedType`, its return type is immediately substituted using the type arguments. *Note: This was partially addressed in previous sessions but clearly has gaps, especially for interfaces like Iterable.*

### Phase 2: Implement Target Type Inference
**Goal:** Allow `<T> T empty()` to be assigned to `String s = empty()`.
1.  **Enhance `ProcessMethodName`**: If type inference from arguments is insufficient (unconstrained variables remain), use the expected result type (`target_type`) to constrain the inference variables.

### Phase 3: Expand API Stubs
**Goal:** Make tool tests pass.
1.  **`runtime/com/sun/javadoc`**: Add `RootDoc`, `Doclet`, `ClassDoc`, etc.
2.  **`runtime/com/sun/tools/javac/api`**: Add/Update `JavacTask`, `JavacTaskImpl` with correct signatures.

### Phase 4: Bridge Methods (Cleanup)
**Goal:** Bytecode correctness.
1.  **Review `GenerateBridgeMethods`**: Ensure bridges are generated for covariant return types in interfaces and abstract classes.

## Recommendation
Start with **Phase 1 (Member Lookup & Substitution)**. Fixing `BoxedForeach.java` is the single most high-leverage task, as it validates the core generics implementation which supports the rest of the language features.
